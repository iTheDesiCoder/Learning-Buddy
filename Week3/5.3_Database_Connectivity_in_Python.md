# Database Connectivity in Python

---

## ðŸ”¹ Introduction
- Database connectivity is a critical part of application development.  
- COBOL often connects to **DB2** or other mainframe databases using embedded SQL.  
- Java uses **JDBC**; C# uses **ADO.NET / Entity Framework**.  
- Python provides both **built-in support** (`sqlite3`) and **third-party libraries** (`psycopg2`, `mysql-connector`, `sqlalchemy`, `ibm_db`).  

---

## ðŸ”¹ SQLite (Built-in Database)
```python
import sqlite3

conn = sqlite3.connect("example.db")
cursor = conn.cursor()
cursor.execute("CREATE TABLE IF NOT EXISTS users (id INT, name TEXT, age INT)")
cursor.execute("INSERT INTO users VALUES (1, 'Alice', 30)")
cursor.execute("INSERT INTO users VALUES (2, 'Bob', 25)")
conn.commit()
cursor.execute("SELECT * FROM users")
print(cursor.fetchall())
conn.close()
```

---

## ðŸ”¹ PostgreSQL with `psycopg2`
```python
import psycopg2

conn = psycopg2.connect(
    host="localhost",
    database="testdb",
    user="postgres",
    password="password"
)
cursor = conn.cursor()
cursor.execute("CREATE TABLE IF NOT EXISTS employees (id SERIAL PRIMARY KEY, name TEXT, salary INT)")
cursor.execute("INSERT INTO employees (name, salary) VALUES (%s, %s)", ("Alice", 5000))
conn.commit()
cursor.execute("SELECT * FROM employees")
print(cursor.fetchall())
cursor.close()
conn.close()
```

---

## ðŸ”¹ MySQL with `mysql-connector-python`
```python
import mysql.connector

conn = mysql.connector.connect(
    host="localhost",
    user="root",
    password="password",
    database="testdb"
)
cursor = conn.cursor()
cursor.execute("CREATE TABLE IF NOT EXISTS products (id INT AUTO_INCREMENT PRIMARY KEY, name VARCHAR(50), price DECIMAL(10,2))")
cursor.execute("INSERT INTO products (name, price) VALUES (%s, %s)", ("Laptop", 1200.50))
conn.commit()
cursor.execute("SELECT * FROM products")
print(cursor.fetchall())
cursor.close()
conn.close()
```

---

## ðŸ”¹ SQLAlchemy (ORM)
```python
from sqlalchemy import create_engine, Column, Integer, String
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker

engine = create_engine("sqlite:///company.db")
Base = declarative_base()

class Employee(Base):
    __tablename__ = "employees"
    id = Column(Integer, primary_key=True)
    name = Column(String)
    age = Column(Integer)

Base.metadata.create_all(engine)

Session = sessionmaker(bind=engine)
session = Session()
session.add(Employee(name="Alice", age=30))
session.commit()

for emp in session.query(Employee).all():
    print(emp.id, emp.name, emp.age)
```

---

## ðŸ”¹ DB2 with `ibm_db`
DB2 is widely used with COBOL on mainframes. Python can connect to DB2 using the **ibm_db** driver.

### Installation
```bash
pip install ibm_db
```

### Example: Connect, Insert, Query
```python
import ibm_db

conn_str = (
    "DATABASE=sample;"
    "HOSTNAME=localhost;"
    "PORT=50000;"
    "PROTOCOL=TCPIP;"
    "UID=db2user;"
    "PWD=password;"
)

try:
    conn = ibm_db.connect(conn_str, "", "")
    print("Connected to DB2!")

    # Create table
    create_sql = "CREATE TABLE employees (id INT, name VARCHAR(50), salary DECIMAL(10,2))"
    try:
        ibm_db.exec_immediate(conn, create_sql)
    except:
        print("Table may already exist.")

    # Insert data
    insert_sql = "INSERT INTO employees (id, name, salary) VALUES (1, 'Alice', 5000.00)"
    ibm_db.exec_immediate(conn, insert_sql)

    # Query data
    stmt = ibm_db.exec_immediate(conn, "SELECT * FROM employees")
    result = ibm_db.fetch_assoc(stmt)
    while result:
        print(result)
        result = ibm_db.fetch_assoc(stmt)

    ibm_db.close(conn)

except Exception as e:
    print("Error:", e)
```

---

## ðŸ”¹ DB2 with SQLAlchemy (ORM)
```bash
pip install ibm_db_sa sqlalchemy
```

```python
from sqlalchemy import create_engine, Column, Integer, String, Numeric
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker

engine = create_engine("ibm_db_sa://db2user:password@localhost:50000/sample")
Base = declarative_base()

class Employee(Base):
    __tablename__ = "employees"
    id = Column(Integer, primary_key=True)
    name = Column(String(50))
    salary = Column(Numeric)

Base.metadata.create_all(engine)

Session = sessionmaker(bind=engine)
session = Session()
session.add(Employee(id=2, name="Bob", salary=6000.00))
session.commit()

for emp in session.query(Employee).all():
    print(emp.id, emp.name, emp.salary)
```

---

## ðŸ”¹ COBOL / Java / C# Mapping
| Language | Database Connectivity |
|----------|------------------------|
| **COBOL** | Embedded SQL with DB2, precompiled with program. |
| **Java** | JDBC (`DriverManager.getConnection`), ORM frameworks (Hibernate). |
| **C#** | ADO.NET (`SqlConnection`), ORM (Entity Framework). |
| **Python** | `sqlite3` built-in, `psycopg2` for PostgreSQL, `mysql-connector`, `ibm_db` for DB2, or ORM with `sqlalchemy`. |

---

## ðŸ’¡ Exercises

1. Use `sqlite3` to create a table `students` with columns `id`, `name`, `grade`. Insert 3 records and query them.  
2. Connect to PostgreSQL using `psycopg2` and insert a row into an `employees` table.  
3. Connect to MySQL and create a `products` table with 2 records. Query all rows.  
4. Connect to DB2 using `ibm_db`, create an `accounts` table, insert records, and query them.  
5. Use SQLAlchemy with DB2 to define a `Department` class (`id`, `name`). Insert 2 departments and query them.  

---
