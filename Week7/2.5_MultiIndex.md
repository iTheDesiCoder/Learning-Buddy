# Chapter 5: MultiIndex in Pandas

In this chapter, we will explore **MultiIndex** in Pandas.  
MultiIndex allows us to work with hierarchical indexing (rows and columns with multiple levels).  
We will use **Customer.csv** and **Order.csv** for examples.

---

## 1. Intro to MultiIndex

MultiIndex is useful when we need to analyze data across **multiple keys**.

Example: Create MultiIndex using `AccountNumber` and `OrderNumber`.

```python
import pandas as pd

orders = pd.read_csv("Order.csv")
orders_mi = orders.set_index(["AccountNumber", "OrderNumber"])
print(orders_mi.head())
```

---

## 2. Create a MultiIndex

You can also create a MultiIndex manually.

```python
arrays = [
    ["A", "A", "B", "B"],
    [1, 2, 1, 2]
]
mi = pd.MultiIndex.from_arrays(arrays, names=("Letter", "Number"))
df = pd.DataFrame({"Value": [10,20,30,40]}, index=mi)
print(df)
```

---

## 3. Extract Index Level Values

```python
print(orders_mi.index.get_level_values("AccountNumber")[:5])
```

---

## 4. Rename Index Labels

```python
orders_mi = orders_mi.rename_axis(index={"AccountNumber": "AcctNum", "OrderNumber": "OrdNum"})
print(orders_mi.head())
```

---

## 5. The sort_index Method on a MultiIndex DataFrame

```python
print(orders_mi.sort_index().head())
```

---

## 6. Extract Rows from a MultiIndex DataFrame

```python
print(orders_mi.loc[(1001, 2001)])   # Order for Account 1001 and Order 2001
```

---

## 7. The transpose Method

```python
print(orders_mi.head().transpose())
```

---

## 8. The stack Method

```python
stacked = orders_mi[["SecurityType", "Qty"]].stack()
print(stacked.head())
```

---

## 9. The unstack Method

```python
unstacked = stacked.unstack()
print(unstacked.head())
```

---

## 10. The pivot Method

Pivot transforms columns into rows.

```python
pivot_df = orders.pivot(index="AccountNumber", columns="SecurityType", values="Qty")
print(pivot_df.head())
```

---

## 11. The melt Method

Melt transforms rows into columns.

```python
melt_df = orders.melt(id_vars=["AccountNumber"], value_vars=["Qty","Price"], var_name="Metric", value_name="Value")
print(melt_df.head())
```

---

## 12. The pivot_table Method

```python
pivot_table = orders.pivot_table(index="SecurityType", values="Qty", aggfunc="sum")
print(pivot_table)
```

---

# üìù Practice Exercises

1. Create MultiIndex with `AccountNumber` and `SecurityType`.  
2. Sort the MultiIndex DataFrame by AccountNumber.  
3. Use `.stack()` and `.unstack()` on Order data.  
4. Pivot data to show total `Qty` by `AccountNumber` and `SecurityType`.  
5. Melt the order data so that `Qty` and `Price` become part of a single "Metric" column.  
