# Final Case Study: Portfolio Analysis with Pandas & Dask

In this **Capstone Project**, we will combine everything we‚Äôve learned using **Customer.csv** and **Order.csv**.  
The goal is to generate a **financial report** that shows portfolio values, rankings, and breakdowns.  

---

## 1. Load and Merge Data

```python
import pandas as pd

customers = pd.read_csv("Customer.csv")
orders = pd.read_csv("Order.csv")

# Merge on AccountNumber
merged = pd.merge(customers, orders, on="AccountNumber", how="inner")
print(merged.head())
```

---

## 2. Compute Total Order Value

```python
merged["TotalValue"] = merged["Qty"] * merged["Price"]
print(merged[["CustomerName", "SecurityType", "Qty", "Price", "TotalValue"]].head())
```

---

## 3. Portfolio Value per Customer

```python
portfolio = merged.groupby("CustomerName")["TotalValue"].sum().reset_index()
portfolio = portfolio.sort_values("TotalValue", ascending=False)
print(portfolio.head(10))
```

---

## 4. Portfolio Value per State

```python
state_summary = merged.groupby("State")["TotalValue"].sum().reset_index()
print(state_summary.sort_values("TotalValue", ascending=False))
```

---

## 5. Security Type Breakdown

```python
security_summary = merged.groupby("SecurityType")["TotalValue"].sum().reset_index()
print(security_summary)
```

---

## 6. Top Securities by Value

```python
top_securities = merged.groupby("SecurityName")["TotalValue"].sum().reset_index()
print(top_securities.sort_values("TotalValue", ascending=False).head(10))
```

---

## 7. Customer Ranking

Add ranking to portfolio values.

```python
portfolio["Rank"] = portfolio["TotalValue"].rank(ascending=False)
print(portfolio.head(10))
```

---

## 8. State-wise Top Customers

```python
state_top = merged.groupby(["State","CustomerName"])["TotalValue"].sum().reset_index()
print(state_top.sort_values(["State","TotalValue"], ascending=[True, False]).groupby("State").head(3))
```

---

## 9. Export Final Report

```python
portfolio.to_csv("Portfolio_Report.csv", index=False)
state_summary.to_csv("State_Summary.csv", index=False)
security_summary.to_csv("Security_Summary.csv", index=False)
```

---

## 10. Bonus: Using Dask for Larger Data

```python
import dask.dataframe as dd

ddf = dd.read_csv("Order.csv")
print(ddf.groupby("SecurityType")["Qty"].sum().compute())
```

---

# üìù Practice Exercises

1. Find the **top 5 customers in each State** by Total Portfolio Value.  
2. Create a report of **average Price per SecurityType**.  
3. Find the **most frequently ordered SecurityName**.  
4. Generate a pivot table: rows = State, columns = SecurityType, values = TotalValue.  
5. Export the pivot table as `State_Security_Report.csv`.  

---
